#!/usr/bin/env node

const packageJson = require('../package.json');
const envinfo = require('../src');
const argv = require('minimist')(process.argv.slice(2));

argv.console = true;

if (argv.help || argv._.indexOf('help') > -1) {
  // eslint-disable-next-line no-console
  console.log(`
  ,,',                                  ,,             ,,,,,,           ,',,
 ,,,                                                  ,,,                  ,,,
 ,,       ,,,,,    ,,,,,,   ,,,     ,,  ,,  .,,,,,,   ,,,,,,,   ,,,,,       ,,
 ,,     ,,    ,,  ,,,   ,,,  ,,    ,,,  ,,  ,,,   ,,, ,,      ,,,   ,,,     ,,
 ,,,   ,,     .,, ,,,    ,,  ,,,   ,,   ,,  ,,,    ,, ,,     ,,      ,,     ,,,
 ,,    ,,,,,,,,,, ,,,    ,,   ,,  ,,    ,,  ,,,    ,, ,,     ,,      ,,     ,,
 ,,    ,,,        ,,,    ,,    ,,,,,    ,,  ,,,    ,, ,,     ,,,    ,,,     ,,
 ,,      ,,,,,,,  ,,,    ,,     ,,,     ,,  ,,,    ,, ,,       ,,,,,,,      ,,
 ,,,                                                                       ,,,
  ,,,'                                                                  ',,,

  VERSION: ${packageJson.version}

  USAGE:

    \`envinfo\` || \`npx envinfo\`

  OPTIONS:

    --register             Register an envinfo plugin
    --fullTree             Traverse entire node_modules dependency tree, not just top level

    --markdown             Print output in markdown format
    --json                 Print output in JSON format
    --console              Print to console (defaults to on for CLI usage, off for programmatic usage)
    --clipboard            Copy output to your system clipboard
    --showNotFound         Don't filter out values marked 'Not Found'
    --title                Give your report a top level title ie 'Environment Report'
  `);
  process.exit(0);
} else if (argv.version || argv.v || argv._.indexOf('version') > -1) {
  // eslint-disable-next-line no-console
  console.log(packageJson.version);
  process.exit(0);
}

const plugin = require('../plugin');
const { options = {}, sections = [] } = require('../preset/jest');

envinfo(Object.assign({}, options, argv), sections, plugin)
  .then(info => {
    console.log(JSON.stringify(info, null, 2));
  })
  .catch(error => {
    console.error(error);
  });
